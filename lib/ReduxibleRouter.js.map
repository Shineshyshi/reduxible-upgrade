{"version":3,"sources":["../src/ReduxibleRouter.js"],"names":["ReduxibleRouter","options","history","store","routes","container","errorContainer","devTools","extras","renderComponent","component","error","Html","ReactDOMServer","renderToString","provide","children","renderServer","location","route","redirectLocation","rendered","resolve","reject","renderProps","Error","renderClient","callback","ReactDOM","render","getRouter","renderClientWithDevTools","window","React","getRouterWithDevTools","DevTools"],"mappings":"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","file":"ReduxibleRouter.js","sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport ReactDOMServer from \"react-dom/server\";\nimport { Router, match, __RouterContext } from \"react-router\";\nimport { Provider } from \"react-redux\";\nimport { syncReduxAndRouter } from \"redux-simple-router\";\n\nexport default class ReduxibleRouter {\n  constructor(options, history, store) {\n    this.routes = options.routes;\n    this.container = options.container;\n    this.errorContainer = options.errorContainer;\n    this.devTools = options.devTools;\n    this.extras = options.extras;\n    this.history = history;\n    this.store = store;\n    syncReduxAndRouter(history, store);\n  }\n\n  static renderComponent({\n    container,\n    component = <div></div>,\n    error,\n    store = {},\n    extras = {},\n  }) {\n    const Html = container;\n    return (\n      \"<!doctype html>\\n\" +\n      ReactDOMServer.renderToString(\n        <Html component={component} error={error} store={store} {...extras} />\n      )\n    );\n  }\n\n  provide(children) {\n    return (\n      <Provider store={this.store} key=\"provider\">\n        {children}\n      </Provider>\n    );\n  }\n\n  async renderServer(location) {\n    try {\n      const [redirectLocation, component] = await this.route(location);\n      const { container, store, extras } = this;\n      return {\n        redirectLocation,\n        rendered: ReduxibleRouter.renderComponent({\n          container,\n          component,\n          store,\n          extras,\n        }),\n      };\n    } catch (error) {\n      const { errorContainer: container, extras } = this;\n      if (container) {\n        error.component = ReduxibleRouter.renderComponent({\n          container,\n          error,\n          extras,\n        });\n      }\n      throw error;\n    }\n  }\n\n  route(location) {\n    return new Promise((resolve, reject) => {\n      match(\n        { routes: this.routes, location },\n        (error, redirectLocation, renderProps) => {\n          if (error) {\n            return reject(error);\n          }\n\n          if (!redirectLocation && !renderProps) {\n            return reject(\n              new Error(\n                \"Failed to route. There is no matching path. Please check your routes configuration.\"\n              )\n            );\n          }\n\n          if (redirectLocation) {\n            return resolve([redirectLocation]);\n          }\n          if (renderProps) {\n            return resolve([\n              null,\n              this.provide(<__RouterContext {...renderProps} />),\n            ]);\n          }\n        }\n      );\n    });\n  }\n\n  renderClient(container, callback) {\n    ReactDOM.render(this.provide(this.getRouter()), container, callback);\n  }\n\n  renderClientWithDevTools(container, callback) {\n    window.React = React;\n    // render twice is necessary.\n    // if not, React shows invalid server-client DOM sync error.\n    ReactDOM.render(\n      this.provide(this.getRouterWithDevTools()),\n      container,\n      callback\n    );\n  }\n\n  getRouter() {\n    return <Router history={this.history} routes={this.routes} />;\n  }\n\n  getRouterWithDevTools() {\n    const DevTools = this.devTools;\n    return (\n      <div>\n        {this.getRouter()} <DevTools />\n      </div>\n    );\n  }\n}\n"]}