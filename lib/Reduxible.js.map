{"version":3,"sources":["../src/Reduxible.js"],"names":["Reduxible","options","config","ReduxibleConfig","routerFactory","RouterFactory","storeFactory","StoreFactory","useDevTools","initialActions","server","isServer","Error","req","res","next","isUniversal","send","renderContainer","history","store","createStore","preInitialize","router","createRouter","url","originalUrl","renderServer","redirectLocation","rendered","redirect","pathname","stack","component","status","willDispatch","map","action","resolve","dispatch","all","client","initialState","container","callback","isClient","useHashHistory","error","renderClient","renderClientWithDevTools"],"mappings":"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","file":"Reduxible.js","sourcesContent":["import ReduxibleConfig from \"./ReduxibleConfig\";\nimport StoreFactory from \"./StoreFactory\";\nimport RouterFactory from \"./RouterFactory\";\nimport {\n  createBrowserHistory,\n  createHashHistory,\n  createMemoryHistory,\n} from \"history\";\nimport contextMiddleware from \"./contextMiddlerware\";\nimport warning from \"./warning\";\n\nexport default class Reduxible {\n  constructor(options = {}) {\n    this.config = new ReduxibleConfig(options.config || options);\n    this.routerFactory = new RouterFactory(options);\n    this.storeFactory = new StoreFactory({\n      ...options,\n      useDevTools: this.config.useDevTools(),\n    });\n    this.initialActions = options.initialActions || [];\n  }\n\n  server() {\n    if (!this.config.isServer()) {\n      throw new Error(\n        \"A server() only can be called in server environment. Please check your config arguments.\"\n      );\n    }\n    return async (req, res, next) => {\n      try {\n        if (!this.config.isUniversal()) {\n          return res.send(this.routerFactory.renderContainer());\n        }\n\n        const history = createMemoryHistory();\n        const store = this.storeFactory.createStore({}, [\n          contextMiddleware({ config: this.config, history, req, res, next }),\n        ]);\n\n        await this.preInitialize(store);\n\n        const router = this.routerFactory.createRouter(history, store);\n        const url = req.originalUrl || req.url || \"/\";\n        const { redirectLocation, rendered } = await router.renderServer(\n          url,\n          store\n        );\n\n        if (redirectLocation) {\n          return res.redirect(redirectLocation.pathname);\n        }\n\n        return res.send(rendered);\n      } catch (error) {\n        warning(error.stack);\n\n        if (error.component) {\n          res.status(500);\n          return res.send(error.component);\n        }\n\n        return next(error);\n      }\n    };\n  }\n\n  async preInitialize(store) {\n    try {\n      const willDispatch = this.initialActions.map((action) =>\n        Promise.resolve(store.dispatch(action))\n      );\n      return await Promise.all(willDispatch);\n    } catch (error) {\n      warning(\"Failed to PreInitialize. Render with initialStates.\");\n      warning(error.stack);\n    }\n  }\n\n  client(initialState = {}, container, callback) {\n    if (!this.config.isClient()) {\n      throw new Error(\n        \"A client() only can be called in browser. Please check your config arguments.\"\n      );\n    }\n\n    if (!container) {\n      throw new Error(\"A container element is empty.\");\n    }\n\n    let history;\n    try {\n      history = this.config.useHashHistory()\n        ? createHashHistory()\n        : createBrowserHistory();\n    } catch (error) {\n      warning(\"Failed to initialize browser history. Use memory history.\");\n      history = createMemoryHistory();\n    }\n    const store = this.storeFactory.createStore(initialState, [\n      contextMiddleware({ config: this.config, history }),\n    ]);\n    const router = this.routerFactory.createRouter(history, store);\n\n    router.renderClient(container, callback);\n\n    if (this.config.useDevTools()) {\n      router.renderClientWithDevTools(container, callback);\n    }\n  }\n}\n"]}